<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center</title>
    <style>
        :root {
            --bg: #0a0f0a;
            --bg-secondary: #0d120d;
            --card-bg: #141f14;
            --card-border: #1e2e1e;
            --card-hover: #1a2a1a;
            --text: #ffffff;
            --text-secondary: #8a9a8a;
            --text-dim: #5a6a5a;
            --green: #2d5a2d;
            --green-light: #4a8c4a;
            --green-bright: #5cb85c;
            --green-glow: rgba(92, 184, 92, 0.3);
            --red: #8b3a3a;
            --red-light: #a85454;
            --gold: #d4a530;
            --blue: #4a90d4;
            --purple: #8b5cf6;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Layout */
        .app { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--card-border);
            padding: 16px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 24px;
            padding: 8px;
            cursor: pointer;
            border-radius: 10px;
            transition: background 0.2s;
        }

        .logo:hover {
            background: var(--card-hover);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--green-light), var(--green));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Home button */
        .home-btn {
            margin-bottom: 16px;
            background: var(--green) !important;
            border-color: var(--green) !important;
        }

        .home-btn.hidden { display: none; }

        /* Project switcher */
        .project-switcher {
            margin-bottom: 24px;
        }

        .project-switcher-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 8px;
            padding: 0 12px;
        }

        .project-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 6px;
        }

        .project-btn:hover { background: var(--card-hover); border-color: var(--green); }
        .project-btn.active { border-color: var(--green-bright); background: var(--green); }

        .project-btn .icon { font-size: 1.25rem; }
        .project-btn .name { font-weight: 600; flex: 1; text-align: left; }
        .project-btn .badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            background: var(--red-light);
        }

        /* Section nav */
        .section-nav {
            flex: 1;
        }

        .nav-group-title {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin: 16px 0 8px;
            padding: 0 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            font-size: 0.9rem;
        }

        .nav-item:hover { color: var(--text); background: var(--card-hover); }
        .nav-item.active { color: var(--text); background: var(--green); }

        .nav-item .icon { width: 20px; text-align: center; }

        /* User section */
        .user-section {
            padding-top: 16px;
            border-top: 1px solid var(--card-border);
            margin-top: auto;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-info { flex: 1; }
        .user-name { font-weight: 600; font-size: 0.875rem; }
        .user-role { font-size: 0.75rem; color: var(--text-secondary); }

        /* Main content */
        .main { flex: 1; margin-left: 240px; }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--card-border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .breadcrumb-link {
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .breadcrumb-link:hover {
            color: var(--green-bright);
        }

        .breadcrumb-sep {
            color: var(--text-dim);
        }

        .breadcrumb-current {
            color: var(--text);
            font-weight: 600;
        }

        .header-actions { display: flex; gap: 8px; }

        .container { padding: 24px; max-width: 1200px; }

        /* Page sections */
        .page { display: none; }
        .page.active { display: block; }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 16px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .metric-value.good { color: var(--green-bright); }
        .metric-value.warn { color: var(--gold); }
        .metric-value.bad { color: var(--red-light); }

        .metric-target {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        /* Section cards */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--card-border);
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .btn {
            padding: 8px 14px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover { background: var(--card-hover); border-color: var(--green); }
        .btn.primary { background: var(--green); border-color: var(--green); }
        .btn.primary:hover { background: var(--green-light); }

        /* Cards grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }

        .card:hover { border-color: var(--green); }
        .card.clickable { cursor: pointer; }
        .card.clickable:hover { transform: translateY(-2px); }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .card-icon {
            font-size: 1.5rem;
            width: 44px;
            height: 44px;
            background: var(--card-hover);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-title { font-weight: 600; font-size: 1rem; }
        .card-subtitle { font-size: 0.8125rem; color: var(--text-secondary); }

        .card-stats {
            display: flex;
            gap: 16px;
            font-size: 0.8125rem;
        }

        .card-stat { display: flex; align-items: center; gap: 4px; }
        .card-stat.p0 { color: var(--red-light); }
        .card-stat.p1 { color: var(--gold); }
        .card-stat.done { color: var(--green-bright); }

        /* Task list */
        .task-list { display: flex; flex-direction: column; gap: 8px; }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover { background: var(--card-hover); border-color: var(--green); }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--card-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-item:hover .task-checkbox { border-color: var(--green); }
        .task-item.done .task-checkbox { background: var(--green); border-color: var(--green); }
        .task-item.done .task-checkbox::after { content: '‚úì'; color: white; font-size: 12px; }

        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 700;
        }

        .task-priority.P0 { background: var(--red); color: white; }
        .task-priority.P1 { background: var(--gold); color: #1a1a1a; }
        .task-priority.P2 { background: var(--card-border); color: var(--text-secondary); }

        .task-content { flex: 1; min-width: 0; }
        .task-title { font-weight: 500; }
        .task-meta { font-size: 0.75rem; color: var(--text-secondary); display: flex; gap: 8px; }

        .task-section {
            font-size: 0.625rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--card-hover);
            text-transform: uppercase;
        }

        .task-assignee {
            width: 28px;
            height: 28px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Intel feed */
        .feed-container { display: flex; flex-direction: column; gap: 12px; }

        .feed-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .feed-card:hover { border-color: var(--green); }

        .feed-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px 20px;
            cursor: pointer;
        }

        .feed-icon {
            font-size: 1.25rem;
            width: 40px;
            height: 40px;
            background: var(--card-hover);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .feed-content { flex: 1; min-width: 0; }
        .feed-title { font-weight: 600; margin-bottom: 4px; }
        .feed-summary { font-size: 0.875rem; color: var(--text-secondary); }

        .feed-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .feed-tags { display: flex; gap: 6px; flex-wrap: wrap; }

        .feed-tag {
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--card-hover);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .feed-tag.competitive { color: var(--red-light); }
        .feed-tag.market { color: var(--blue); }
        .feed-tag.technical { color: var(--purple); }
        .feed-tag.opportunity { color: var(--green-bright); }
        .feed-tag.urgent { color: var(--gold); background: rgba(212, 165, 48, 0.15); }

        .feed-author {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .feed-author-avatar {
            width: 18px;
            height: 18px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .feed-time { font-size: 0.75rem; color: var(--text-dim); }

        .feed-expand { color: var(--text-dim); transition: transform 0.2s; }
        .feed-card.expanded .feed-expand { transform: rotate(180deg); }

        .feed-details {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid var(--card-border);
        }

        .feed-card.expanded .feed-details { display: block; }

        .feed-section { margin-top: 16px; }

        .feed-section-title {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .feed-section ul { margin: 0; padding-left: 20px; }
        .feed-section li { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px; }

        .feed-insight {
            background: rgba(92, 184, 92, 0.1);
            border: 1px solid rgba(92, 184, 92, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 12px;
            font-size: 0.875rem;
        }

        .feed-insight-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--green-bright);
            margin-bottom: 4px;
        }

        /* Pipeline table */
        .pipeline-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pipeline-table th, .pipeline-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        .pipeline-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .deal-amount { color: var(--green-bright); font-weight: 600; }

        /* Activity feed */
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--card-border);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            background: var(--card-hover);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content { flex: 1; }
        .activity-summary { font-size: 0.875rem; }
        .activity-meta { font-size: 0.75rem; color: var(--text-dim); margin-top: 2px; }

        /* Filter tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 8px 14px;
            border-radius: 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tab:hover { color: var(--text); border-color: var(--green); }
        .filter-tab.active { background: var(--green); border-color: var(--green); color: var(--text); }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 48px;
            color: var(--text-secondary);
        }

        .empty-state .icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo" onclick="goHome()" title="Back to Founder View">
                <div class="logo-icon">‚ö°</div>
                <span>COMMAND</span>
            </div>

            <!-- Home button - always visible -->
            <button class="project-btn home-btn" onclick="goHome()" id="home-btn">
                <span class="icon">üè†</span>
                <span class="name">Home</span>
            </button>

            <div class="project-switcher" id="project-switcher">
                <!-- Populated by JS -->
            </div>

            <nav class="section-nav" id="section-nav">
                <!-- Populated by JS based on project -->
            </nav>

            <div class="user-section">
                <div class="user-badge">
                    <div class="user-avatar">J</div>
                    <div class="user-info">
                        <div class="user-name">Jonathan</div>
                        <div class="user-role">Founder</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main">
            <header class="header">
                <div class="header-title" id="header-title">
                    <!-- Set by JS -->
                </div>
                <div class="header-actions">
                    <button class="btn" onclick="refreshData()">‚Üª Refresh</button>
                    <button class="btn primary" onclick="showAddModal()">+ Add</button>
                </div>
            </header>

            <div class="container" id="content">
                <!-- Pages rendered by JS -->
            </div>
        </main>
    </div>

    <script>
        // State
        let data = null;
        let currentProject = 'founder';
        let currentSection = 'splash';

        // Section configs per project type
        const sectionConfigs = {
            founder: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'intelligence', icon: 'üì°', label: 'All Intel' },
                { id: 'tasks', icon: '‚úÖ', label: 'All Tasks' },
                { id: 'activity', icon: 'üìä', label: 'Activity' }
            ],
            product: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'product', icon: 'üõ†Ô∏è', label: 'Product' },
                { id: 'intelligence', icon: 'üì°', label: 'Intelligence' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'operations', icon: '‚öôÔ∏è', label: 'Operations' },
                { id: 'growth', icon: 'üìà', label: 'Growth' }
            ],
            sales: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'sales', icon: 'üí∞', label: 'Sales' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'operations', icon: '‚öôÔ∏è', label: 'Operations' },
                { id: 'intelligence', icon: 'üì°', label: 'Intelligence' }
            ],
            operations: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'sales', icon: 'üí∞', label: 'Clients' },
                { id: 'operations', icon: '‚öôÔ∏è', label: 'Operations' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'growth', icon: 'üìà', label: 'Growth' }
            ],
            meta: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'product', icon: 'üõ†Ô∏è', label: 'Capabilities' },
                { id: 'operations', icon: '‚öôÔ∏è', label: 'Operations' },
                { id: 'intelligence', icon: 'üì°', label: 'Learning' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' }
            ]
        };

        // Load data
        async function loadData() {
            try {
                const res = await fetch('data/unified.json');
                data = await res.json();
            } catch (e) {
                console.error('Failed to load data:', e);
                data = { projects: [], tasks: [], intel: [], metrics: [], activity: [], contributors: [] };
            }
            render();
        }

        function refreshData() {
            loadData();
        }

        // Time formatting
        function timeAgo(ts) {
            const diff = Math.floor((Date.now() - new Date(ts)) / 1000);
            if (diff < 60) return 'just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function formatCurrency(val) {
            if (val >= 1000000) return `$${(val / 1000000).toFixed(1)}M`;
            if (val >= 1000) return `$${(val / 1000).toFixed(0)}K`;
            return `$${val.toFixed(2)}`;
        }

        function formatMetric(val, format) {
            if (format === 'currency') return formatCurrency(val);
            if (format === 'percent') return `${val}%`;
            return val.toString();
        }

        // Navigation
        function goHome() {
            currentProject = 'founder';
            currentSection = 'splash';
            window.location.hash = '';
            render();
        }

        function setProject(projectId) {
            currentProject = projectId;
            currentSection = 'splash';
            render();
            // Update URL hash
            window.location.hash = projectId === 'founder' ? '' : projectId;
        }

        function setSection(sectionId) {
            currentSection = sectionId;
            renderContent();
            renderNav();
        }

        // Render sidebar
        function renderSidebar() {
            const switcher = document.getElementById('project-switcher');
            const homeBtn = document.getElementById('home-btn');
            const projects = data?.projects || [];

            // Show/hide home button based on current view
            if (currentProject === 'founder') {
                homeBtn.classList.add('hidden');
            } else {
                homeBtn.classList.remove('hidden');
            }

            // Project switcher label + buttons
            let html = '<div class="project-switcher-label">Projects</div>';

            // Project buttons
            projects.forEach(p => {
                const tasks = (data.tasks || []).filter(t => t.projectId === p.id && t.status !== 'done');
                const p0Count = tasks.filter(t => t.priority === 'P0').length;

                html += `
                    <button class="project-btn ${currentProject === p.id ? 'active' : ''}" onclick="setProject('${p.id}')" style="--accent: ${p.color}">
                        <span class="icon">${p.icon}</span>
                        <span class="name">${p.name}</span>
                        ${p0Count > 0 ? `<span class="badge">${p0Count}</span>` : ''}
                    </button>
                `;
            });

            switcher.innerHTML = html;
            renderNav();
        }

        function renderNav() {
            const nav = document.getElementById('section-nav');
            const project = data?.projects?.find(p => p.id === currentProject);
            const focus = project?.focus || 'founder';
            const sections = sectionConfigs[focus] || sectionConfigs.founder;

            nav.innerHTML = sections.map(s => `
                <div class="nav-item ${currentSection === s.id ? 'active' : ''}" onclick="setSection('${s.id}')">
                    <span class="icon">${s.icon}</span>
                    <span>${s.label}</span>
                </div>
            `).join('');
        }

        // Render header with breadcrumbs
        function renderHeader() {
            const header = document.getElementById('header-title');
            const project = data?.projects?.find(p => p.id === currentProject);
            const sectionConfig = getSectionConfig();
            const currentSectionLabel = sectionConfig?.find(s => s.id === currentSection)?.label || 'Overview';

            if (currentProject === 'founder') {
                header.innerHTML = `
                    <div class="breadcrumb">
                        <span class="breadcrumb-current">üëÅÔ∏è Founder Command Center</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${currentSectionLabel}</span>
                    </div>
                `;
            } else {
                header.innerHTML = `
                    <div class="breadcrumb">
                        <span class="breadcrumb-link" onclick="goHome()">üè† Home</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${project?.icon || 'üìÅ'} ${project?.name || currentProject}</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${currentSectionLabel}</span>
                    </div>
                `;
            }
        }

        function getSectionConfig() {
            const project = data?.projects?.find(p => p.id === currentProject);
            const focus = project?.focus || 'founder';
            return sectionConfigs[focus] || sectionConfigs.founder;
        }

        // Render content
        function renderContent() {
            const container = document.getElementById('content');
            renderHeader();

            if (currentProject === 'founder') {
                container.innerHTML = renderFounderView();
            } else {
                container.innerHTML = renderProjectView();
            }

            // Attach event handlers
            attachEventHandlers();
        }

        function renderFounderView() {
            switch (currentSection) {
                case 'splash': return renderFounderSplash();
                case 'intelligence': return renderIntelPage();
                case 'tasks': return renderTasksPage();
                case 'activity': return renderActivityPage();
                default: return renderFounderSplash();
            }
        }

        function renderProjectView() {
            switch (currentSection) {
                case 'splash': return renderProjectSplash();
                case 'product': return renderProductPage();
                case 'sales': return renderSalesPage();
                case 'operations': return renderOpsPage();
                case 'growth': return renderGrowthPage();
                case 'intelligence': return renderIntelPage();
                case 'tasks': return renderTasksPage();
                default: return renderProjectSplash();
            }
        }

        // FOUNDER SPLASH
        function renderFounderSplash() {
            const projects = data?.projects || [];
            
            // Cross-project metrics
            const totalTasks = (data.tasks || []).filter(t => t.status !== 'done').length;
            const p0Tasks = (data.tasks || []).filter(t => t.status !== 'done' && t.priority === 'P0').length;
            const recentIntel = (data.intel || []).length;

            let html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Open Tasks</div>
                        <div class="metric-value">${totalTasks}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">P0 Blockers</div>
                        <div class="metric-value ${p0Tasks > 0 ? 'bad' : 'good'}">${p0Tasks}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Intel Items</div>
                        <div class="metric-value">${recentIntel}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Active Projects</div>
                        <div class="metric-value">${projects.length}</div>
                    </div>
                </div>

                <div class="section-header">
                    <div class="section-title">Projects</div>
                </div>
                <div class="cards-grid">
            `;

            projects.forEach(p => {
                const tasks = (data.tasks || []).filter(t => t.projectId === p.id && t.status !== 'done');
                const p0 = tasks.filter(t => t.priority === 'P0').length;
                const p1 = tasks.filter(t => t.priority === 'P1').length;
                const done = (data.tasks || []).filter(t => t.projectId === p.id && t.status === 'done').length;

                html += `
                    <div class="card clickable" onclick="setProject('${p.id}')">
                        <div class="card-header">
                            <div class="card-icon">${p.icon}</div>
                            <div>
                                <div class="card-title">${p.name}</div>
                                <div class="card-subtitle">${p.description}</div>
                            </div>
                        </div>
                        <div class="card-stats">
                            ${p0 > 0 ? `<span class="card-stat p0">üî¥ ${p0} P0</span>` : ''}
                            ${p1 > 0 ? `<span class="card-stat p1">üü° ${p1} P1</span>` : ''}
                            ${done > 0 ? `<span class="card-stat done">‚úì ${done} done</span>` : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            // Recent intel
            html += `
                <div class="section-header">
                    <div class="section-title">Recent Intelligence</div>
                    <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                </div>
            `;

            const recentItems = (data.intel || []).slice(0, 3);
            html += '<div class="feed-container">' + recentItems.map(renderIntelCard).join('') + '</div>';

            return html;
        }

        // PROJECT SPLASH
        function renderProjectSplash() {
            const project = data?.projects?.find(p => p.id === currentProject);
            if (!project) return '<div class="empty-state"><div class="icon">üìÅ</div>Project not found</div>';

            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject);
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.status !== 'done');
            const intel = (data.intel || []).filter(i => (i.projectIds || []).includes(currentProject));

            let html = '<div class="metrics-grid">';
            
            metrics.slice(0, 4).forEach(m => {
                const statusClass = m.target ? (m.value >= m.target * 0.8 ? 'good' : m.value >= m.target * 0.5 ? 'warn' : 'bad') : '';
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value ${statusClass}">${formatMetric(m.value, m.format)}</div>
                        ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                    </div>
                `;
            });

            html += `
                </div>

                <div class="section-header">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">
                    ${tasks.slice(0, 5).map(renderTaskItem).join('')}
                </div>

                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">Recent Intel (${intel.length})</div>
                    <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                </div>
                <div class="feed-container">
                    ${intel.slice(0, 3).map(renderIntelCard).join('')}
                </div>
            `;

            return html;
        }

        // PRODUCT PAGE
        function renderProductPage() {
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.section === 'product');
            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject && m.section === 'product');

            let html = `
                <div class="metrics-grid">
                    ${metrics.map(m => `
                        <div class="metric-card">
                            <div class="metric-label">${m.name}</div>
                            <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="section-header">
                    <div class="section-title">Product Tasks</div>
                    <button class="btn primary" onclick="showAddModal('task', 'product')">+ Add Task</button>
                </div>
                <div class="task-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No product tasks</div>'}
                </div>
            `;

            return html;
        }

        // SALES PAGE
        function renderSalesPage() {
            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject && m.section === 'sales');
            const pipeline = data.pipelines?.[currentProject] || [];
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.section === 'sales');

            let html = `
                <div class="metrics-grid">
                    ${metrics.map(m => `
                        <div class="metric-card">
                            <div class="metric-label">${m.name}</div>
                            <div class="metric-value ${m.trend === 'up' ? 'good' : ''}">${formatMetric(m.value, m.format)}</div>
                            ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;

            if (pipeline.length > 0) {
                html += `
                    <div class="section-header">
                        <div class="section-title">Pipeline</div>
                    </div>
                    <div class="card">
                        <table class="pipeline-table">
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Amount</th>
                                    <th>Product</th>
                                    <th>Status</th>
                                    <th>Next Step</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pipeline.map(d => `
                                    <tr>
                                        <td>${d.account}</td>
                                        <td class="deal-amount">${formatCurrency(d.amount)}</td>
                                        <td>${d.product}</td>
                                        <td>${d.status}</td>
                                        <td>${d.nextStep || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            html += `
                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">Sales Tasks</div>
                    <button class="btn primary" onclick="showAddModal('task', 'sales')">+ Add Task</button>
                </div>
                <div class="task-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No sales tasks</div>'}
                </div>
            `;

            return html;
        }

        // OPS PAGE
        function renderOpsPage() {
            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject && m.section === 'operations');
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.section === 'operations');

            return `
                <div class="metrics-grid">
                    ${metrics.map(m => `
                        <div class="metric-card">
                            <div class="metric-label">${m.name}</div>
                            <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="section-header">
                    <div class="section-title">Operations Tasks</div>
                    <button class="btn primary" onclick="showAddModal('task', 'operations')">+ Add Task</button>
                </div>
                <div class="task-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No operations tasks</div>'}
                </div>
            `;
        }

        // GROWTH PAGE
        function renderGrowthPage() {
            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject && m.section === 'growth');
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.section === 'growth');

            return `
                <div class="metrics-grid">
                    ${metrics.map(m => `
                        <div class="metric-card">
                            <div class="metric-label">${m.name}</div>
                            <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                            ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                        </div>
                    `).join('')}
                </div>

                <div class="section-header">
                    <div class="section-title">Growth Tasks</div>
                    <button class="btn primary" onclick="showAddModal('task', 'growth')">+ Add Task</button>
                </div>
                <div class="task-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No growth tasks</div>'}
                </div>
            `;
        }

        // INTEL PAGE
        function renderIntelPage() {
            let intel = data?.intel || [];
            
            if (currentProject !== 'founder') {
                intel = intel.filter(i => (i.projectIds || []).includes(currentProject));
            }

            intel = [...intel].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            return `
                <div class="filter-tabs">
                    <div class="filter-tab active" data-type="all">All</div>
                    <div class="filter-tab" data-type="competitive">‚öîÔ∏è Competitive</div>
                    <div class="filter-tab" data-type="market">üìä Market</div>
                    <div class="filter-tab" data-type="technical">üîß Technical</div>
                    <div class="filter-tab" data-type="opportunity">üí° Opportunity</div>
                </div>

                <div class="feed-container" id="intel-feed">
                    ${intel.map(renderIntelCard).join('') || '<div class="empty-state"><div class="icon">üì°</div>No intelligence yet</div>'}
                </div>
            `;
        }

        // TASKS PAGE
        function renderTasksPage() {
            let tasks = data?.tasks || [];
            
            if (currentProject !== 'founder') {
                tasks = tasks.filter(t => t.projectId === currentProject);
            }

            // Sort by priority then status
            const pOrder = { P0: 0, P1: 1, P2: 2, P3: 3 };
            const sOrder = { pending: 0, in_progress: 1, blocked: 2, done: 3 };
            tasks = [...tasks].sort((a, b) => {
                const pDiff = (pOrder[a.priority] || 2) - (pOrder[b.priority] || 2);
                if (pDiff !== 0) return pDiff;
                return (sOrder[a.status] || 0) - (sOrder[b.status] || 0);
            });

            return `
                <div class="filter-tabs">
                    <div class="filter-tab active" data-status="all">All</div>
                    <div class="filter-tab" data-status="pending">Pending</div>
                    <div class="filter-tab" data-status="in_progress">In Progress</div>
                    <div class="filter-tab" data-status="done">Done</div>
                </div>

                <div class="section-header">
                    <div class="section-title">${tasks.length} Tasks</div>
                    <button class="btn primary" onclick="showAddModal('task')">+ Add Task</button>
                </div>

                <div class="task-list" id="tasks-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state"><div class="icon">‚úÖ</div>No tasks</div>'}
                </div>
            `;
        }

        // ACTIVITY PAGE
        function renderActivityPage() {
            const activity = (data?.activity || []).slice().sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const icons = {
                task_created: '‚ûï',
                task_completed: '‚úÖ',
                intel_added: 'üì°',
                decision_made: 'üéØ',
                note_added: 'üìù'
            };

            return `
                <div class="section-header">
                    <div class="section-title">Activity Feed</div>
                </div>
                <div class="card">
                    ${activity.map(a => {
                        const contributor = data.contributors?.find(c => c.id === a.contributorId);
                        const project = data.projects?.find(p => p.id === a.projectId);
                        return `
                            <div class="activity-item">
                                <div class="activity-icon">${icons[a.type] || 'üìå'}</div>
                                <div class="activity-content">
                                    <div class="activity-summary">
                                        <strong>${contributor?.name || 'Unknown'}</strong> ${a.summary}
                                    </div>
                                    <div class="activity-meta">${project?.name || ''} ‚Ä¢ ${timeAgo(a.timestamp)}</div>
                                </div>
                            </div>
                        `;
                    }).join('') || '<div class="empty-state">No activity yet</div>'}
                </div>
            `;
        }

        // RENDER HELPERS
        function renderTaskItem(task) {
            const assignee = data?.contributors?.find(c => c.id === task.assigneeId);
            const project = data?.projects?.find(p => p.id === task.projectId);

            return `
                <div class="task-item ${task.status}" data-id="${task.id}">
                    <div class="task-checkbox" onclick="toggleTask('${task.id}', event)"></div>
                    <span class="task-priority ${task.priority || 'P2'}">${task.priority || 'P2'}</span>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            ${currentProject === 'founder' ? `<span class="task-section" style="background: ${project?.color}22; color: ${project?.color}">${project?.name || task.projectId}</span>` : ''}
                            <span class="task-section">${task.section}</span>
                            ${task.tags?.slice(0, 2).map(t => `<span>${t}</span>`).join('') || ''}
                        </div>
                    </div>
                    <div class="task-assignee">${assignee?.avatar || '?'}</div>
                </div>
            `;
        }

        function renderIntelCard(intel) {
            const contributor = data?.contributors?.find(c => c.id === intel.createdBy);
            const details = intel.details || {};

            let detailsHtml = '';
            
            if (intel.sources?.length) {
                detailsHtml += `<div class="feed-section">
                    <div class="feed-section-title">Sources</div>
                    ${intel.sources.map(s => 
                        s.url ? `<a href="${s.url}" target="_blank" style="color: var(--blue); text-decoration: none; display: block; margin-bottom: 4px;">${s.name} ‚Üó</a>` : s.name
                    ).join('')}
                </div>`;
            }

            if (details.keyFacts?.length) {
                detailsHtml += `<div class="feed-section">
                    <div class="feed-section-title">Key Facts</div>
                    <ul>${details.keyFacts.map(f => `<li>${f}</li>`).join('')}</ul>
                </div>`;
            }

            const insight = details.sosOpportunity || details.sosDifferentiation || details.approach;
            if (insight) {
                detailsHtml += `<div class="feed-insight">
                    <div class="feed-insight-label">üí° Insight</div>
                    ${insight}
                </div>`;
            }

            return `
                <div class="feed-card" data-id="${intel.id}">
                    <div class="feed-header" onclick="toggleIntel('${intel.id}')">
                        <div class="feed-icon">${intel.icon}</div>
                        <div class="feed-content">
                            <div class="feed-title">${intel.title}</div>
                            <div class="feed-summary">${intel.summary}</div>
                            <div class="feed-meta">
                                <div class="feed-tags">
                                    ${(intel.tags || []).map(t => `<span class="feed-tag ${t}">${t}</span>`).join('')}
                                </div>
                                <div class="feed-author">
                                    <div class="feed-author-avatar">${contributor?.avatar || '?'}</div>
                                    ${contributor?.name || 'Unknown'}
                                </div>
                                <div class="feed-time">${timeAgo(intel.createdAt)}</div>
                            </div>
                        </div>
                        <div class="feed-expand">‚ñº</div>
                    </div>
                    <div class="feed-details">${detailsHtml}</div>
                </div>
            `;
        }

        // EVENT HANDLERS
        function attachEventHandlers() {
            // Intel type filter
            document.querySelectorAll('.filter-tab[data-type]').forEach(tab => {
                tab.onclick = () => {
                    document.querySelectorAll('.filter-tab[data-type]').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    filterIntel(tab.dataset.type);
                };
            });

            // Task status filter
            document.querySelectorAll('.filter-tab[data-status]').forEach(tab => {
                tab.onclick = () => {
                    document.querySelectorAll('.filter-tab[data-status]').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    filterTasks(tab.dataset.status);
                };
            });
        }

        function filterIntel(type) {
            document.querySelectorAll('.feed-card').forEach(card => {
                if (type === 'all') {
                    card.style.display = '';
                } else {
                    const tags = [...card.querySelectorAll('.feed-tag')].map(t => t.textContent);
                    card.style.display = tags.includes(type) ? '' : 'none';
                }
            });
        }

        function filterTasks(status) {
            document.querySelectorAll('.task-item').forEach(item => {
                if (status === 'all') {
                    item.style.display = '';
                } else {
                    item.style.display = item.classList.contains(status) ? '' : 'none';
                }
            });
        }

        function toggleTask(id, event) {
            event.stopPropagation();
            const item = event.target.closest('.task-item');
            item.classList.toggle('done');
            // TODO: persist to JSON
        }

        function toggleIntel(id) {
            document.querySelectorAll(`.feed-card[data-id="${id}"]`).forEach(card => {
                card.classList.toggle('expanded');
            });
        }

        function showAddModal(type, section) {
            // TODO: implement modal
            const title = prompt(`Add ${type || 'item'} title:`);
            if (title) alert(`Will add: ${title} (section: ${section || 'general'})`);
        }

        // RENDER ALL
        function render() {
            renderSidebar();
            renderContent();
        }

        // Handle URL hash
        function handleHash() {
            const hash = window.location.hash.slice(1);
            if (hash && data?.projects?.find(p => p.id === hash)) {
                currentProject = hash;
            } else {
                currentProject = 'founder';
            }
            render();
        }

        // Initialize
        loadData().then(() => {
            handleHash();
            window.addEventListener('hashchange', handleHash);
        });
    </script>
</body>
</html>
