<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center</title>
    <style>
        :root {
            --bg: #0a0f0a;
            --bg-secondary: #0d120d;
            --card-bg: #141f14;
            --card-border: #1e2e1e;
            --card-hover: #1a2a1a;
            --text: #ffffff;
            --text-secondary: #8a9a8a;
            --text-dim: #5a6a5a;
            --green: #2d5a2d;
            --green-light: #4a8c4a;
            --green-bright: #5cb85c;
            --green-glow: rgba(92, 184, 92, 0.3);
            --red: #8b3a3a;
            --red-light: #a85454;
            --gold: #d4a530;
            --blue: #4a90d4;
            --purple: #8b5cf6;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Layout */
        .app { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--card-border);
            padding: 16px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 24px;
            padding: 8px;
            cursor: pointer;
            border-radius: 10px;
            transition: background 0.2s;
        }

        .logo:hover {
            background: var(--card-hover);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--green-light), var(--green));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Home button */
        .home-btn {
            margin-bottom: 16px;
            background: var(--green) !important;
            border-color: var(--green) !important;
        }

        .home-btn.hidden { display: none; }

        /* Project switcher */
        .project-switcher {
            margin-bottom: 24px;
        }

        .project-switcher-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 8px;
            padding: 0 12px;
        }

        .project-btn {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 6px;
        }

        .project-btn:hover { background: var(--card-hover); border-color: var(--green); }
        .project-btn.active { border-color: var(--green-bright); background: var(--green); }

        .project-btn .icon { font-size: 1.25rem; }
        .project-btn .name { font-weight: 600; flex: 1; text-align: left; }
        .project-btn .badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            background: var(--red-light);
        }

        /* Section nav */
        .section-nav {
            flex: 1;
        }

        .nav-group-title {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin: 16px 0 8px;
            padding: 0 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            font-size: 0.9rem;
        }

        .nav-item:hover { color: var(--text); background: var(--card-hover); }
        .nav-item.active { color: var(--text); background: var(--green); }

        .nav-item .icon { width: 20px; text-align: center; }

        /* User section */
        .user-section {
            padding-top: 16px;
            border-top: 1px solid var(--card-border);
            margin-top: auto;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .user-info { flex: 1; }
        .user-name { font-weight: 600; font-size: 0.875rem; }
        .user-role { font-size: 0.75rem; color: var(--text-secondary); }

        /* Main content */
        .main { flex: 1; margin-left: 240px; }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--card-border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .breadcrumb-link {
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s;
        }

        .breadcrumb-link:hover {
            color: var(--green-bright);
        }

        .breadcrumb-sep {
            color: var(--text-dim);
        }

        .breadcrumb-current {
            color: var(--text);
            font-weight: 600;
        }

        .header-actions { display: flex; gap: 8px; }

        .container { padding: 24px; max-width: 1200px; }

        /* Page sections */
        .page { display: none; }
        .page.active { display: block; }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 16px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .metric-value.good { color: var(--green-bright); }
        .metric-value.warn { color: var(--gold); }
        .metric-value.bad { color: var(--red-light); }

        .metric-target {
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 4px;
        }

        /* Section cards */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--card-border);
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .btn {
            padding: 8px 14px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover { background: var(--card-hover); border-color: var(--green); }
        .btn.primary { background: var(--green); border-color: var(--green); }
        .btn.primary:hover { background: var(--green-light); }

        /* Cards grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }

        .card:hover { border-color: var(--green); }
        .card.clickable { cursor: pointer; }
        .card.clickable:hover { transform: translateY(-2px); }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .card-icon {
            font-size: 1.5rem;
            width: 44px;
            height: 44px;
            background: var(--card-hover);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-title { font-weight: 600; font-size: 1rem; }
        .card-subtitle { font-size: 0.8125rem; color: var(--text-secondary); }

        .card-stats {
            display: flex;
            gap: 16px;
            font-size: 0.8125rem;
        }

        .card-stat { display: flex; align-items: center; gap: 4px; }
        .card-stat.p0 { color: var(--red-light); }
        .card-stat.p1 { color: var(--gold); }
        .card-stat.done { color: var(--green-bright); }

        /* Task list */
        .task-list { display: flex; flex-direction: column; gap: 8px; }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover { background: var(--card-hover); border-color: var(--green); }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--card-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .task-item:hover .task-checkbox { border-color: var(--green); }
        .task-item.done .task-checkbox { background: var(--green); border-color: var(--green); }
        .task-item.done .task-checkbox::after { content: '‚úì'; color: white; font-size: 12px; }

        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 700;
        }

        .task-priority.P0 { background: var(--red); color: white; }
        .task-priority.P1 { background: var(--gold); color: #1a1a1a; }
        .task-priority.P2 { background: var(--card-border); color: var(--text-secondary); }

        .task-content { flex: 1; min-width: 0; }
        .task-title { font-weight: 500; }
        .task-meta { font-size: 0.75rem; color: var(--text-secondary); display: flex; gap: 8px; }

        .task-section {
            font-size: 0.625rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--card-hover);
            text-transform: uppercase;
        }

        .task-assignee {
            width: 28px;
            height: 28px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Intel feed */
        .feed-container { display: flex; flex-direction: column; gap: 12px; }

        .feed-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .feed-card:hover { border-color: var(--green); }

        .feed-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px 20px;
            cursor: pointer;
        }

        .feed-icon {
            font-size: 1.25rem;
            width: 40px;
            height: 40px;
            background: var(--card-hover);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .feed-content { flex: 1; min-width: 0; }
        .feed-title { font-weight: 600; margin-bottom: 4px; }
        .feed-summary { font-size: 0.875rem; color: var(--text-secondary); }

        .feed-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .feed-tags { display: flex; gap: 6px; flex-wrap: wrap; }

        .feed-tag {
            padding: 3px 8px;
            border-radius: 4px;
            background: var(--card-hover);
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .feed-tag.competitive { color: var(--red-light); }
        .feed-tag.market { color: var(--blue); }
        .feed-tag.technical { color: var(--purple); }
        .feed-tag.opportunity { color: var(--green-bright); }
        .feed-tag.urgent { color: var(--gold); background: rgba(212, 165, 48, 0.15); }
        .feed-tag.funding { color: var(--gold); }
        .feed-tag.strategy { color: var(--purple); }
        .feed-tag.grants { color: var(--green-bright); }

        .feed-author {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .feed-author-avatar {
            width: 18px;
            height: 18px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .feed-time { font-size: 0.75rem; color: var(--text-dim); }

        .feed-expand { color: var(--text-dim); transition: transform 0.2s; }
        .feed-card.expanded .feed-expand { transform: rotate(180deg); }

        .feed-details {
            display: none;
            padding: 0 20px 20px;
            border-top: 1px solid var(--card-border);
        }

        .feed-card.expanded .feed-details { display: block; }

        .feed-section { margin-top: 16px; }

        .feed-section-title {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 8px;
        }

        .feed-section ul { margin: 0; padding-left: 20px; }
        .feed-section li { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 4px; }

        .feed-insight {
            background: rgba(92, 184, 92, 0.1);
            border: 1px solid rgba(92, 184, 92, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 12px;
            font-size: 0.875rem;
        }

        .feed-insight-label {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--green-bright);
            margin-bottom: 4px;
        }

        /* Pipeline table */
        .pipeline-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pipeline-table th, .pipeline-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        .pipeline-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .deal-amount { color: var(--green-bright); font-weight: 600; }

        .status-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-badge.hot { background: rgba(212, 165, 48, 0.2); color: var(--gold); }
        .status-badge.warm { background: rgba(74, 144, 212, 0.2); color: var(--blue); }
        .status-badge.pending { background: rgba(139, 92, 246, 0.2); color: var(--purple); }
        .status-badge.applied { background: rgba(92, 184, 92, 0.2); color: var(--green-bright); }

        .fit-score {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
        }
        .fit-score.high { color: var(--green-bright); }
        .fit-score.medium { color: var(--gold); }
        .fit-score.low { color: var(--text-secondary); }

        /* Activity feed */
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--card-border);
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            background: var(--card-hover);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-content { flex: 1; }
        .activity-summary { font-size: 0.875rem; }
        .activity-meta { font-size: 0.75rem; color: var(--text-dim); margin-top: 2px; }

        /* Filter tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 8px 14px;
            border-radius: 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tab:hover { color: var(--text); border-color: var(--green); }
        .filter-tab.active { background: var(--green); border-color: var(--green); color: var(--text); }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 48px;
            color: var(--text-secondary);
        }

        .empty-state .icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }

        /* AI Recommendations */
        .recommendation-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .recommendation-card.high { border-left: 3px solid var(--red-light); }
        .recommendation-card.medium { border-left: 3px solid var(--gold); }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .recommendation-priority {
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .recommendation-priority.high { background: rgba(168, 84, 84, 0.3); color: var(--red-light); }
        .recommendation-priority.medium { background: rgba(212, 165, 48, 0.2); color: var(--gold); }

        .recommendation-category {
            font-size: 0.6875rem;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .recommendation-title { font-weight: 600; margin-bottom: 4px; }
        .recommendation-rationale { font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 8px; }
        .recommendation-action {
            font-size: 0.8125rem;
            color: var(--green-bright);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* State targets table */
        .state-targets { margin-top: 24px; }

        /* Two column layout */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        @media (max-width: 900px) {
            .two-col { grid-template-columns: 1fr; }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo" onclick="goHome()" title="Back to Founder View">
                <div class="logo-icon">‚ö°</div>
                <span>COMMAND</span>
            </div>

            <!-- Home button - always visible -->
            <button class="project-btn home-btn" onclick="goHome()" id="home-btn">
                <span class="icon">üè†</span>
                <span class="name">Home</span>
            </button>

            <div class="project-switcher" id="project-switcher">
                <!-- Populated by JS -->
            </div>

            <nav class="section-nav" id="section-nav">
                <!-- Populated by JS based on project -->
            </nav>

            <div class="user-section">
                <div class="user-badge">
                    <div class="user-avatar">J</div>
                    <div class="user-info">
                        <div class="user-name">Jonathan</div>
                        <div class="user-role">Founder</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main">
            <header class="header">
                <div class="header-title" id="header-title">
                    <!-- Set by JS -->
                </div>
                <div class="header-actions">
                    <button class="btn" onclick="refreshData()">‚Üª Refresh</button>
                </div>
            </header>

            <div class="container" id="content">
                <!-- Pages rendered by JS -->
            </div>
        </main>
    </div>

    <script>
        // State
        let data = null;
        let currentProject = 'founder';
        let currentSection = 'splash';

        // Section configs per project - now project-specific
        const sectionConfigs = {
            founder: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'intelligence', icon: 'üì°', label: 'All Intel' },
                { id: 'tasks', icon: '‚úÖ', label: 'All Tasks' },
                { id: 'activity', icon: 'üìä', label: 'Activity' }
            ],
            sos: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'grants', icon: 'üéÅ', label: 'Grants Pipeline' },
                { id: 'partners', icon: 'ü§ù', label: 'Partners & States' },
                { id: 'intelligence', icon: 'üì°', label: 'Intel' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'recommendations', icon: 'ü§ñ', label: 'AI Recommendations' }
            ],
            reforge: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'pipeline', icon: 'üí∞', label: 'Deals Pipeline' },
                { id: 'leads', icon: 'üéØ', label: 'Target Leads' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'intelligence', icon: 'üì°', label: 'Intel' }
            ],
            harmony: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'clients', icon: 'üë•', label: 'Clients' },
                { id: 'operations', icon: '‚öôÔ∏è', label: 'Operations' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'intelligence', icon: 'üì°', label: 'Intel' }
            ],
            grunt: [
                { id: 'splash', icon: 'üè†', label: 'Overview' },
                { id: 'capabilities', icon: 'üõ†Ô∏è', label: 'Capabilities' },
                { id: 'costs', icon: 'üíµ', label: 'API Costs' },
                { id: 'tasks', icon: '‚úÖ', label: 'Tasks' },
                { id: 'intelligence', icon: 'üì°', label: 'Intel' }
            ]
        };

        // Load data
        async function loadData() {
            try {
                const res = await fetch('data/unified.json');
                data = await res.json();
            } catch (e) {
                console.error('Failed to load data:', e);
                data = { projects: [], tasks: [], intel: [], metrics: [], activity: [], contributors: [] };
            }
            
            // Handle hash-based navigation
            const hash = window.location.hash.slice(1);
            if (hash && data.projects?.find(p => p.id === hash)) {
                currentProject = hash;
            }
            
            render();
        }

        function refreshData() {
            loadData();
        }

        // Time formatting
        function timeAgo(ts) {
            const diff = Math.floor((Date.now() - new Date(ts)) / 1000);
            if (diff < 60) return 'just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return `${Math.floor(diff / 86400)}d ago`;
        }

        function formatCurrency(val) {
            if (val >= 1000000) return `$${(val / 1000000).toFixed(1)}M`;
            if (val >= 1000) return `$${(val / 1000).toFixed(0)}K`;
            return `$${val.toFixed(2)}`;
        }

        function formatMetric(val, format) {
            if (format === 'currency') return formatCurrency(val);
            if (format === 'percent') return `${val}%`;
            return val.toString();
        }

        // Navigation
        function goHome() {
            currentProject = 'founder';
            currentSection = 'splash';
            window.location.hash = '';
            render();
        }

        function setProject(projectId) {
            currentProject = projectId;
            currentSection = 'splash';
            window.location.hash = projectId === 'founder' ? '' : projectId;
            render();
        }

        function setSection(sectionId) {
            currentSection = sectionId;
            renderContent();
            renderNav();
        }

        // Render sidebar
        function renderSidebar() {
            const switcher = document.getElementById('project-switcher');
            const homeBtn = document.getElementById('home-btn');
            const projects = data?.projects || [];

            // Show/hide home button based on current view
            if (currentProject === 'founder') {
                homeBtn.classList.add('hidden');
            } else {
                homeBtn.classList.remove('hidden');
            }

            // Project switcher label + buttons
            let html = '<div class="project-switcher-label">Projects</div>';

            // Project buttons
            projects.forEach(p => {
                const tasks = (data.tasks || []).filter(t => t.projectId === p.id && t.status !== 'done');
                const p0Count = tasks.filter(t => t.priority === 'P0').length;

                html += `
                    <button class="project-btn ${currentProject === p.id ? 'active' : ''}" onclick="setProject('${p.id}')" style="--accent: ${p.color}">
                        <span class="icon">${p.icon}</span>
                        <span class="name">${p.name}</span>
                        ${p0Count > 0 ? `<span class="badge">${p0Count}</span>` : ''}
                    </button>
                `;
            });

            switcher.innerHTML = html;
            renderNav();
        }

        function renderNav() {
            const nav = document.getElementById('section-nav');
            const sections = sectionConfigs[currentProject] || sectionConfigs.founder;

            nav.innerHTML = sections.map(s => `
                <div class="nav-item ${currentSection === s.id ? 'active' : ''}" onclick="setSection('${s.id}')">
                    <span class="icon">${s.icon}</span>
                    <span>${s.label}</span>
                </div>
            `).join('');
        }

        // Render header with breadcrumbs
        function renderHeader() {
            const header = document.getElementById('header-title');
            const project = data?.projects?.find(p => p.id === currentProject);
            const sections = sectionConfigs[currentProject] || sectionConfigs.founder;
            const currentSectionLabel = sections.find(s => s.id === currentSection)?.label || 'Overview';

            if (currentProject === 'founder') {
                header.innerHTML = `
                    <div class="breadcrumb">
                        <span class="breadcrumb-current">üëÅÔ∏è Founder Command Center</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${currentSectionLabel}</span>
                    </div>
                `;
            } else {
                header.innerHTML = `
                    <div class="breadcrumb">
                        <span class="breadcrumb-link" onclick="goHome()">üè† Home</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${project?.icon || 'üìÅ'} ${project?.name || currentProject}</span>
                        <span class="breadcrumb-sep">‚Ä∫</span>
                        <span class="breadcrumb-current">${currentSectionLabel}</span>
                    </div>
                `;
            }
        }

        // Main render function
        function render() {
            renderSidebar();
            renderContent();
        }

        // Render content based on project and section
        function renderContent() {
            const container = document.getElementById('content');
            renderHeader();

            if (currentProject === 'founder') {
                container.innerHTML = renderFounderContent();
            } else if (currentProject === 'sos') {
                container.innerHTML = renderSOSContent();
            } else if (currentProject === 'reforge') {
                container.innerHTML = renderReforgeContent();
            } else if (currentProject === 'harmony') {
                container.innerHTML = renderHarmonyContent();
            } else if (currentProject === 'grunt') {
                container.innerHTML = renderGruntContent();
            } else {
                container.innerHTML = renderGenericProjectContent();
            }

            attachEventHandlers();
        }

        // ============ FOUNDER VIEW ============
        function renderFounderContent() {
            switch (currentSection) {
                case 'splash': return renderFounderSplash();
                case 'intelligence': return renderIntelPage();
                case 'tasks': return renderTasksPage();
                case 'activity': return renderActivityPage();
                default: return renderFounderSplash();
            }
        }

        function renderFounderSplash() {
            const projects = data?.projects || [];
            
            const totalTasks = (data.tasks || []).filter(t => t.status !== 'done').length;
            const p0Tasks = (data.tasks || []).filter(t => t.status !== 'done' && t.priority === 'P0').length;
            const recentIntel = (data.intel || []).length;

            let html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Open Tasks</div>
                        <div class="metric-value">${totalTasks}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">P0 Blockers</div>
                        <div class="metric-value ${p0Tasks > 0 ? 'bad' : 'good'}">${p0Tasks}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Intel Items</div>
                        <div class="metric-value">${recentIntel}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Active Projects</div>
                        <div class="metric-value">${projects.length}</div>
                    </div>
                </div>

                <div class="section-header">
                    <div class="section-title">Projects</div>
                </div>
                <div class="cards-grid">
            `;

            projects.forEach(p => {
                const tasks = (data.tasks || []).filter(t => t.projectId === p.id && t.status !== 'done');
                const p0 = tasks.filter(t => t.priority === 'P0').length;
                const p1 = tasks.filter(t => t.priority === 'P1').length;
                const done = (data.tasks || []).filter(t => t.projectId === p.id && t.status === 'done').length;

                html += `
                    <div class="card clickable" onclick="setProject('${p.id}')">
                        <div class="card-header">
                            <div class="card-icon">${p.icon}</div>
                            <div>
                                <div class="card-title">${p.name}</div>
                                <div class="card-subtitle">${p.description}</div>
                            </div>
                        </div>
                        <div class="card-stats">
                            ${p0 > 0 ? `<span class="card-stat p0">üî¥ ${p0} P0</span>` : ''}
                            ${p1 > 0 ? `<span class="card-stat p1">üü° ${p1} P1</span>` : ''}
                            ${done > 0 ? `<span class="card-stat done">‚úì ${done} done</span>` : ''}
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            // Recent intel
            html += `
                <div class="section-header">
                    <div class="section-title">Recent Intelligence</div>
                    <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                </div>
            `;

            const recentItems = (data.intel || []).slice(0, 3);
            html += '<div class="feed-container">' + recentItems.map(renderIntelCard).join('') + '</div>';

            return html;
        }

        // ============ SOS PROJECT ============
        function renderSOSContent() {
            switch (currentSection) {
                case 'splash': return renderSOSSplash();
                case 'grants': return renderSOSGrants();
                case 'partners': return renderSOSPartners();
                case 'intelligence': return renderIntelPage();
                case 'tasks': return renderTasksPage();
                case 'recommendations': return renderSOSRecommendations();
                default: return renderSOSSplash();
            }
        }

        function renderSOSSplash() {
            const metrics = (data.metrics || []).filter(m => m.projectId === 'sos');
            const tasks = (data.tasks || []).filter(t => t.projectId === 'sos' && t.status !== 'done');
            const intel = (data.intel || []).filter(i => (i.projectIds || []).includes('sos'));
            const grants = data.pipelines?.sos_grants || [];

            let html = '<div class="metrics-grid">';
            metrics.slice(0, 4).forEach(m => {
                const statusClass = m.target ? (m.value >= m.target * 0.8 ? 'good' : m.value >= m.target * 0.5 ? 'warn' : 'bad') : '';
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value ${statusClass}">${formatMetric(m.value, m.format)}</div>
                        ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                    </div>
                `;
            });
            html += '</div>';

            // Quick view of grants pipeline
            html += `
                <div class="section-header">
                    <div class="section-title">üéÅ Grants Pipeline (${grants.length})</div>
                    <button class="btn" onclick="setSection('grants')">View All ‚Üí</button>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead><tr><th>Grant</th><th>Fit</th><th>Status</th><th>Deadline</th></tr></thead>
                        <tbody>
            `;
            grants.slice(0, 3).forEach(g => {
                const fitClass = g.fitScore >= 8 ? 'high' : g.fitScore >= 6 ? 'medium' : 'low';
                html += `
                    <tr>
                        <td>${g.name}</td>
                        <td><span class="fit-score ${fitClass}">${g.fitScore}/10</span></td>
                        <td><span class="status-badge pending">${g.status}</span></td>
                        <td>${g.deadline || 'Rolling'}</td>
                    </tr>
                `;
            });
            html += '</tbody></table></div>';

            // Tasks
            html += `
                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">${tasks.slice(0, 5).map(renderTaskItem).join('')}</div>
            `;

            // Intel
            html += `
                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">Latest Intel (${intel.length})</div>
                    <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                </div>
                <div class="feed-container">${intel.slice(0, 2).map(renderIntelCard).join('')}</div>
            `;

            return html;
        }

        function renderSOSGrants() {
            const grants = data.pipelines?.sos_grants || [];
            
            let html = `
                <div class="section-header">
                    <div class="section-title">üéÅ Grants Pipeline</div>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead>
                            <tr>
                                <th>Grant Opportunity</th>
                                <th>Fit Score</th>
                                <th>Status</th>
                                <th>Amount</th>
                                <th>Deadline</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            grants.forEach(g => {
                const fitClass = g.fitScore >= 8 ? 'high' : g.fitScore >= 6 ? 'medium' : 'low';
                html += `
                    <tr>
                        <td><strong>${g.name}</strong></td>
                        <td><span class="fit-score ${fitClass}">‚≠ê ${g.fitScore}/10</span></td>
                        <td><span class="status-badge pending">${g.status}</span></td>
                        <td class="deal-amount">${g.amount || 'TBD'}</td>
                        <td>${g.deadline || 'Rolling'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;

            // Grant-related intel
            const grantIntel = (data.intel || []).filter(i => 
                (i.projectIds || []).includes('sos') && 
                (i.tags || []).some(t => ['funding', 'grants'].includes(t))
            );

            if (grantIntel.length > 0) {
                html += `
                    <div class="section-header" style="margin-top: 24px;">
                        <div class="section-title">üì° Grant Research & Intel</div>
                    </div>
                    <div class="feed-container">${grantIntel.map(renderIntelCard).join('')}</div>
                `;
            }

            return html;
        }

        function renderSOSPartners() {
            const stateTargets = data.pipelines?.sos_state_targets || [];
            
            let html = `
                <div class="section-header">
                    <div class="section-title">üèõÔ∏è State EMA Targets</div>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead>
                            <tr>
                                <th>State</th>
                                <th>Agency</th>
                                <th>Status</th>
                                <th>Opportunity</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            stateTargets.forEach(s => {
                html += `
                    <tr>
                        <td><strong>${s.state}</strong></td>
                        <td>${s.agency}</td>
                        <td><span class="status-badge warm">${s.status}</span></td>
                        <td>${s.opportunity}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;

            // Competitive intel (partners need to know the landscape)
            const competitiveIntel = (data.intel || []).filter(i => 
                (i.projectIds || []).includes('sos') && 
                (i.tags || []).some(t => ['competitive', 'partnership'].includes(t))
            );

            if (competitiveIntel.length > 0) {
                html += `
                    <div class="section-header" style="margin-top: 24px;">
                        <div class="section-title">‚öîÔ∏è Competitive Landscape</div>
                    </div>
                    <div class="feed-container">${competitiveIntel.map(renderIntelCard).join('')}</div>
                `;
            }

            return html;
        }

        function renderSOSRecommendations() {
            const recommendations = data.aiRecommendations || [];
            
            let html = `
                <div class="section-header">
                    <div class="section-title">ü§ñ AI Recommendations</div>
                </div>
            `;

            recommendations.forEach(r => {
                html += `
                    <div class="recommendation-card ${r.priority.toLowerCase()}">
                        <div class="recommendation-header">
                            <span class="recommendation-priority ${r.priority.toLowerCase()}">${r.priority}</span>
                            <span class="recommendation-category">${r.category}</span>
                        </div>
                        <div class="recommendation-title">${r.recommendation}</div>
                        <div class="recommendation-rationale">${r.rationale}</div>
                        <div class="recommendation-action">‚Üí ${r.action}</div>
                    </div>
                `;
            });

            return html;
        }

        // ============ REFORGE PROJECT ============
        function renderReforgeContent() {
            switch (currentSection) {
                case 'splash': return renderReforgeSplash();
                case 'pipeline': return renderReforgePipeline();
                case 'leads': return renderReforgeLeads();
                case 'tasks': return renderTasksPage();
                case 'intelligence': return renderIntelPage();
                default: return renderReforgeSplash();
            }
        }

        function renderReforgeSplash() {
            const metrics = (data.metrics || []).filter(m => m.projectId === 'reforge');
            const pipeline = data.pipelines?.reforge || [];
            const tasks = (data.tasks || []).filter(t => t.projectId === 'reforge' && t.status !== 'done');

            let html = '<div class="metrics-grid">';
            metrics.forEach(m => {
                const statusClass = m.target ? (m.value >= m.target * 0.8 ? 'good' : m.value >= m.target * 0.5 ? 'warn' : 'bad') : '';
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value ${statusClass}">${formatMetric(m.value, m.format)}</div>
                        ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                    </div>
                `;
            });
            html += '</div>';

            // Pipeline preview
            html += `
                <div class="section-header">
                    <div class="section-title">üí∞ Active Pipeline</div>
                    <button class="btn" onclick="setSection('pipeline')">View All ‚Üí</button>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead><tr><th>Account</th><th>Amount</th><th>Product</th><th>Status</th></tr></thead>
                        <tbody>
            `;
            pipeline.slice(0, 4).forEach(d => {
                html += `
                    <tr>
                        <td><strong>${d.account}</strong></td>
                        <td class="deal-amount">${formatCurrency(d.amount)}</td>
                        <td>${d.product}</td>
                        <td><span class="status-badge hot">${d.status}</span></td>
                    </tr>
                `;
            });
            html += '</tbody></table></div>';

            // Tasks
            html += `
                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">${tasks.slice(0, 5).map(renderTaskItem).join('')}</div>
            `;

            return html;
        }

        function renderReforgePipeline() {
            const pipeline = data.pipelines?.reforge || [];
            const totalValue = pipeline.reduce((sum, d) => sum + d.amount, 0);
            
            let html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Pipeline</div>
                        <div class="metric-value good">${formatCurrency(totalValue)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Active Deals</div>
                        <div class="metric-value">${pipeline.length}</div>
                    </div>
                </div>
                
                <div class="section-header">
                    <div class="section-title">üí∞ Deals Pipeline</div>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Amount</th>
                                <th>Product</th>
                                <th>Status</th>
                                <th>Next Step</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            pipeline.forEach(d => {
                html += `
                    <tr>
                        <td><strong>${d.account}</strong></td>
                        <td class="deal-amount">${formatCurrency(d.amount)}</td>
                        <td>${d.product}</td>
                        <td><span class="status-badge hot">${d.status}</span></td>
                        <td>${d.nextStep || '-'}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            return html;
        }

        function renderReforgeLeads() {
            return `
                <div class="section-header">
                    <div class="section-title">üéØ Target Leads</div>
                </div>
                <div class="card" style="text-align: center; padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">üéØ</div>
                    <h3 style="margin-bottom: 8px;">Grunt Swipe App</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 16px;">486 Product leads ready for qualification</p>
                    <a href="https://sos-help-the-helper.github.io/reforge-swipe/" target="_blank" class="btn primary" style="text-decoration: none;">
                        Open Swipe App ‚Üí
                    </a>
                </div>
                
                <div class="section-header" style="margin-top: 24px;">
                    <div class="section-title">üîÑ Re-engagement Opportunities</div>
                </div>
                <div class="card">
                    <table class="pipeline-table">
                        <thead><tr><th>Account</th><th>Value</th><th>Status</th><th>Notes</th></tr></thead>
                        <tbody>
                            <tr>
                                <td><strong>iRobot</strong></td>
                                <td class="deal-amount">$80,000</td>
                                <td><span class="status-badge warm">Closed Lost</span></td>
                                <td>High-value re-engagement target</td>
                            </tr>
                            <tr>
                                <td><strong>WSFS</strong></td>
                                <td class="deal-amount">$56,000</td>
                                <td><span class="status-badge warm">Closed Lost</span></td>
                                <td>Financial services vertical</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        // ============ HARMONY PROJECT ============
        function renderHarmonyContent() {
            switch (currentSection) {
                case 'splash': return renderHarmonySplash();
                case 'clients': return renderHarmonyClients();
                case 'operations': return renderHarmonyOps();
                case 'tasks': return renderTasksPage();
                case 'intelligence': return renderIntelPage();
                default: return renderHarmonySplash();
            }
        }

        function renderHarmonySplash() {
            const metrics = (data.metrics || []).filter(m => m.projectId === 'harmony');
            const tasks = (data.tasks || []).filter(t => t.projectId === 'harmony' && t.status !== 'done');

            let html = '<div class="metrics-grid">';
            metrics.forEach(m => {
                const statusClass = m.target ? (m.value >= m.target * 0.8 ? 'good' : m.value >= m.target * 0.5 ? 'warn' : 'bad') : '';
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value ${statusClass}">${formatMetric(m.value, m.format)}</div>
                        ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                    </div>
                `;
            });
            html += '</div>';

            // Tasks
            html += `
                <div class="section-header">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No active tasks</div>'}</div>
            `;

            return html;
        }

        function renderHarmonyClients() {
            return `
                <div class="section-header">
                    <div class="section-title">üë• Active Clients</div>
                </div>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üè¢</div>
                            <div>
                                <div class="card-title">Client A</div>
                                <div class="card-subtitle">GTM Consulting</div>
                            </div>
                        </div>
                        <div class="card-stats">
                            <span class="card-stat">Monthly retainer</span>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üè¢</div>
                            <div>
                                <div class="card-title">Client B</div>
                                <div class="card-subtitle">RevOps Setup</div>
                            </div>
                        </div>
                        <div class="card-stats">
                            <span class="card-stat">Project-based</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHarmonyOps() {
            const metrics = (data.metrics || []).filter(m => m.projectId === 'harmony' && m.section === 'operations');
            
            let html = '<div class="metrics-grid">';
            metrics.forEach(m => {
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                        ${m.target ? `<div class="metric-target">Target: ${formatMetric(m.target, m.format)}</div>` : ''}
                    </div>
                `;
            });
            html += '</div>';

            const tasks = (data.tasks || []).filter(t => t.projectId === 'harmony' && t.section === 'operations');
            html += `
                <div class="section-header">
                    <div class="section-title">Operations Tasks</div>
                </div>
                <div class="task-list">${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No operations tasks</div>'}</div>
            `;

            return html;
        }

        // ============ GRUNT PROJECT ============
        function renderGruntContent() {
            switch (currentSection) {
                case 'splash': return renderGruntSplash();
                case 'capabilities': return renderGruntCapabilities();
                case 'costs': return renderGruntCosts();
                case 'tasks': return renderTasksPage();
                case 'intelligence': return renderIntelPage();
                default: return renderGruntSplash();
            }
        }

        function renderGruntSplash() {
            const metrics = (data.metrics || []).filter(m => m.projectId === 'grunt');
            const tasks = (data.tasks || []).filter(t => t.projectId === 'grunt' && t.status !== 'done');
            const intel = (data.intel || []).filter(i => (i.projectIds || []).includes('grunt'));

            let html = '<div class="metrics-grid">';
            metrics.forEach(m => {
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                    </div>
                `;
            });
            html += '</div>';

            // Tasks
            html += `
                <div class="section-header">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">${tasks.map(renderTaskItem).join('') || '<div class="empty-state">No active tasks</div>'}</div>
            `;

            // Intel
            if (intel.length > 0) {
                html += `
                    <div class="section-header" style="margin-top: 24px;">
                        <div class="section-title">Intel (${intel.length})</div>
                        <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                    </div>
                    <div class="feed-container">${intel.slice(0, 2).map(renderIntelCard).join('')}</div>
                `;
            }

            return html;
        }

        function renderGruntCapabilities() {
            return `
                <div class="section-header">
                    <div class="section-title">üõ†Ô∏è Active Capabilities</div>
                </div>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üåê</div>
                            <div>
                                <div class="card-title">Web Search</div>
                                <div class="card-subtitle">Brave Search API</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üîç</div>
                            <div>
                                <div class="card-title">Web Fetch</div>
                                <div class="card-subtitle">Content extraction</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìß</div>
                            <div>
                                <div class="card-title">Gmail</div>
                                <div class="card-subtitle">Read & send emails</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üìÖ</div>
                            <div>
                                <div class="card-title">Calendar</div>
                                <div class="card-subtitle">Google Calendar API</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üí¨</div>
                            <div>
                                <div class="card-title">Slack</div>
                                <div class="card-subtitle">Messaging</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üé®</div>
                            <div>
                                <div class="card-title">Canvas</div>
                                <div class="card-subtitle">UI presentation</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGruntCosts() {
            return `
                <div class="section-header">
                    <div class="section-title">üíµ API Costs</div>
                </div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Today</div>
                        <div class="metric-value">$49.25</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">MTD Total</div>
                        <div class="metric-value">$315.68</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Provider</div>
                        <div class="metric-value" style="font-size: 1.25rem;">Anthropic</div>
                    </div>
                </div>
                <div class="card" style="margin-top: 24px;">
                    <div class="section-title" style="margin-bottom: 12px;">Recent Days</div>
                    <table class="pipeline-table">
                        <thead><tr><th>Date</th><th>Cost</th></tr></thead>
                        <tbody>
                            <tr><td>2026-02-02</td><td class="deal-amount">$49.25</td></tr>
                            <tr><td>2026-02-01</td><td class="deal-amount">$180.31</td></tr>
                            <tr><td>2026-01-31</td><td class="deal-amount">$44.21</td></tr>
                            <tr><td>2026-01-30</td><td class="deal-amount">$33.50</td></tr>
                            <tr><td>2026-01-29</td><td class="deal-amount">$8.41</td></tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        // ============ GENERIC PROJECT (fallback) ============
        function renderGenericProjectContent() {
            switch (currentSection) {
                case 'splash': return renderGenericSplash();
                case 'intelligence': return renderIntelPage();
                case 'tasks': return renderTasksPage();
                default: return renderGenericSplash();
            }
        }

        function renderGenericSplash() {
            const project = data?.projects?.find(p => p.id === currentProject);
            const metrics = (data.metrics || []).filter(m => m.projectId === currentProject);
            const tasks = (data.tasks || []).filter(t => t.projectId === currentProject && t.status !== 'done');
            const intel = (data.intel || []).filter(i => (i.projectIds || []).includes(currentProject));

            let html = '<div class="metrics-grid">';
            metrics.slice(0, 4).forEach(m => {
                html += `
                    <div class="metric-card">
                        <div class="metric-label">${m.name}</div>
                        <div class="metric-value">${formatMetric(m.value, m.format)}</div>
                    </div>
                `;
            });
            html += '</div>';

            html += `
                <div class="section-header">
                    <div class="section-title">Active Tasks (${tasks.length})</div>
                    <button class="btn" onclick="setSection('tasks')">View All ‚Üí</button>
                </div>
                <div class="task-list">${tasks.slice(0, 5).map(renderTaskItem).join('')}</div>
            `;

            if (intel.length > 0) {
                html += `
                    <div class="section-header" style="margin-top: 24px;">
                        <div class="section-title">Intel (${intel.length})</div>
                        <button class="btn" onclick="setSection('intelligence')">View All ‚Üí</button>
                    </div>
                    <div class="feed-container">${intel.slice(0, 3).map(renderIntelCard).join('')}</div>
                `;
            }

            return html;
        }

        // ============ SHARED PAGES ============
        function renderIntelPage() {
            let intel = data?.intel || [];
            
            // Filter by project if not on founder view
            if (currentProject !== 'founder') {
                intel = intel.filter(i => (i.projectIds || []).includes(currentProject));
            }

            intel = [...intel].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            return `
                <div class="filter-tabs">
                    <div class="filter-tab active" data-type="all">All</div>
                    <div class="filter-tab" data-type="competitive">‚öîÔ∏è Competitive</div>
                    <div class="filter-tab" data-type="market">üìä Market</div>
                    <div class="filter-tab" data-type="technical">üîß Technical</div>
                    <div class="filter-tab" data-type="opportunity">üí° Opportunity</div>
                    <div class="filter-tab" data-type="funding">üéÅ Funding</div>
                </div>

                <div class="feed-container" id="intel-feed">
                    ${intel.map(renderIntelCard).join('') || '<div class="empty-state"><div class="icon">üì°</div>No intelligence for this project</div>'}
                </div>
            `;
        }

        function renderTasksPage() {
            let tasks = data?.tasks || [];
            
            // Filter by project if not on founder view
            if (currentProject !== 'founder') {
                tasks = tasks.filter(t => t.projectId === currentProject);
            }

            // Sort by priority then status
            const pOrder = { P0: 0, P1: 1, P2: 2, P3: 3 };
            const sOrder = { pending: 0, in_progress: 1, blocked: 2, done: 3 };
            tasks = [...tasks].sort((a, b) => {
                const pDiff = (pOrder[a.priority] || 2) - (pOrder[b.priority] || 2);
                if (pDiff !== 0) return pDiff;
                return (sOrder[a.status] || 0) - (sOrder[b.status] || 0);
            });

            return `
                <div class="filter-tabs">
                    <div class="filter-tab active" data-status="all">All</div>
                    <div class="filter-tab" data-status="pending">Pending</div>
                    <div class="filter-tab" data-status="in_progress">In Progress</div>
                    <div class="filter-tab" data-status="done">Done</div>
                </div>

                <div class="section-header">
                    <div class="section-title">${tasks.length} Tasks</div>
                </div>

                <div class="task-list" id="tasks-list">
                    ${tasks.map(renderTaskItem).join('') || '<div class="empty-state"><div class="icon">‚úÖ</div>No tasks for this project</div>'}
                </div>
            `;
        }

        function renderActivityPage() {
            let activity = data?.activity || [];
            
            // Sort by timestamp
            activity = [...activity].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const icons = {
                task_created: '‚ûï',
                task_completed: '‚úÖ',
                intel_added: 'üì°',
                decision_made: 'üéØ',
                note_added: 'üìù'
            };

            return `
                <div class="section-header">
                    <div class="section-title">Activity Feed</div>
                </div>
                <div class="card">
                    ${activity.map(a => {
                        const contributor = data.contributors?.find(c => c.id === a.contributorId);
                        const project = data.projects?.find(p => p.id === a.projectId);
                        return `
                            <div class="activity-item">
                                <div class="activity-icon">${icons[a.type] || 'üìå'}</div>
                                <div class="activity-content">
                                    <div class="activity-summary">
                                        <strong>${contributor?.name || 'Unknown'}</strong> ${a.summary}
                                    </div>
                                    <div class="activity-meta">${project?.name || ''} ‚Ä¢ ${timeAgo(a.timestamp)}</div>
                                </div>
                            </div>
                        `;
                    }).join('') || '<div class="empty-state">No activity yet</div>'}
                </div>
            `;
        }

        // ============ RENDER HELPERS ============
        function renderTaskItem(task) {
            const assignee = data?.contributors?.find(c => c.id === task.assigneeId);
            const project = data?.projects?.find(p => p.id === task.projectId);

            return `
                <div class="task-item ${task.status}" data-id="${task.id}" data-status="${task.status}">
                    <div class="task-checkbox" onclick="toggleTask('${task.id}', event)"></div>
                    <span class="task-priority ${task.priority || 'P2'}">${task.priority || 'P2'}</span>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            ${currentProject === 'founder' ? `<span class="task-section" style="background: ${project?.color}22; color: ${project?.color}">${project?.name || task.projectId}</span>` : ''}
                            <span class="task-section">${task.section}</span>
                            ${task.tags?.slice(0, 2).map(t => `<span>${t}</span>`).join('') || ''}
                        </div>
                    </div>
                    <div class="task-assignee">${assignee?.avatar || '?'}</div>
                </div>
            `;
        }

        function renderIntelCard(intel) {
            const contributor = data?.contributors?.find(c => c.id === intel.createdBy);
            const details = intel.details || {};

            let detailsHtml = '';
            
            if (intel.sources?.length) {
                detailsHtml += `<div class="feed-section">
                    <div class="feed-section-title">Sources</div>
                    ${intel.sources.map(s => 
                        s.url ? `<a href="${s.url}" target="_blank" style="color: var(--blue); text-decoration: none; display: block; margin-bottom: 4px;">${s.name} ‚Üó</a>` : `<span>${s.name}</span>`
                    ).join('')}
                </div>`;
            }

            if (details.keyFacts?.length) {
                detailsHtml += `<div class="feed-section">
                    <div class="feed-section-title">Key Facts</div>
                    <ul>${details.keyFacts.map(f => `<li>${f}</li>`).join('')}</ul>
                </div>`;
            }

            const insight = details.sosOpportunity || details.sosDifferentiation || details.approach;
            if (insight) {
                detailsHtml += `<div class="feed-insight">
                    <div class="feed-insight-label">üí° Insight</div>
                    ${insight}
                </div>`;
            }

            return `
                <div class="feed-card" data-id="${intel.id}" data-type="${intel.type}">
                    <div class="feed-header" onclick="toggleIntel('${intel.id}')">
                        <div class="feed-icon">${intel.icon}</div>
                        <div class="feed-content">
                            <div class="feed-title">${intel.title}</div>
                            <div class="feed-summary">${intel.summary}</div>
                            <div class="feed-meta">
                                <div class="feed-tags">
                                    ${(intel.tags || []).map(t => `<span class="feed-tag ${t}">${t}</span>`).join('')}
                                </div>
                                <div class="feed-author">
                                    <div class="feed-author-avatar">${contributor?.avatar || '?'}</div>
                                    ${contributor?.name || 'Unknown'}
                                </div>
                                <div class="feed-time">${timeAgo(intel.createdAt)}</div>
                            </div>
                        </div>
                        <div class="feed-expand">‚ñº</div>
                    </div>
                    <div class="feed-details">${detailsHtml}</div>
                </div>
            `;
        }

        // ============ EVENT HANDLERS ============
        function attachEventHandlers() {
            // Intel type filter
            document.querySelectorAll('.filter-tab[data-type]').forEach(tab => {
                tab.onclick = () => {
                    document.querySelectorAll('.filter-tab[data-type]').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    filterIntel(tab.dataset.type);
                };
            });

            // Task status filter
            document.querySelectorAll('.filter-tab[data-status]').forEach(tab => {
                tab.onclick = () => {
                    document.querySelectorAll('.filter-tab[data-status]').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    filterTasks(tab.dataset.status);
                };
            });
        }

        function filterIntel(type) {
            document.querySelectorAll('.feed-card').forEach(card => {
                if (type === 'all') {
                    card.style.display = '';
                } else {
                    const tags = [...card.querySelectorAll('.feed-tag')].map(t => t.textContent);
                    card.style.display = tags.includes(type) ? '' : 'none';
                }
            });
        }

        function filterTasks(status) {
            document.querySelectorAll('.task-item').forEach(item => {
                if (status === 'all') {
                    item.style.display = '';
                } else {
                    item.style.display = item.dataset.status === status ? '' : 'none';
                }
            });
        }

        function toggleIntel(id) {
            const card = document.querySelector(`.feed-card[data-id="${id}"]`);
            if (card) card.classList.toggle('expanded');
        }

        function toggleTask(id, event) {
            event.stopPropagation();
            // In a real app, this would update the data
            const item = document.querySelector(`.task-item[data-id="${id}"]`);
            if (item) {
                item.classList.toggle('done');
            }
        }

        // Handle browser back/forward
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.slice(1);
            if (hash && data?.projects?.find(p => p.id === hash)) {
                currentProject = hash;
                currentSection = 'splash';
            } else {
                currentProject = 'founder';
                currentSection = 'splash';
            }
            render();
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
