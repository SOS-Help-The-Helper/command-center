<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center</title>
    <style>
        :root {
            --bg: #0a0f0a;
            --bg-secondary: #0d120d;
            --card-bg: #141f14;
            --card-border: #1e2e1e;
            --card-hover: #1a2a1a;
            --text: #ffffff;
            --text-secondary: #8a9a8a;
            --text-dim: #5a6a5a;
            --green: #2d5a2d;
            --green-light: #4a8c4a;
            --green-bright: #5cb85c;
            --green-glow: rgba(92, 184, 92, 0.3);
            --red: #8b3a3a;
            --red-light: #a85454;
            --gold: #d4a530;
            --blue: #4a90d4;
            --purple: #8b5cf6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--card-border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--green-light) 0%, var(--green) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--card-bg);
            border-radius: 20px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .user-badge .avatar {
            width: 24px;
            height: 24px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Project cards */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .project-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .project-card:hover {
            background: var(--card-hover);
            border-color: var(--green);
            transform: translateY(-2px);
        }

        .project-card.active {
            border-color: var(--green-bright);
            box-shadow: 0 0 20px var(--green-glow);
        }

        .project-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .project-icon {
            font-size: 1.5rem;
        }

        .project-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .project-stats {
            display: flex;
            gap: 12px;
            font-size: 0.8125rem;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat.p0 { color: var(--red-light); }
        .stat.p1 { color: var(--gold); }
        .stat.p2 { color: var(--text-secondary); }
        .stat.done { color: var(--green-bright); }

        /* Section headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--card-border);
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .section-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--card-border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--card-hover);
            border-color: var(--green);
        }

        .btn.primary {
            background: var(--green);
            border-color: var(--green);
        }

        .btn.primary:hover {
            background: var(--green-light);
        }

        /* Filter tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .filter-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            font-size: 0.8125rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tab:hover {
            color: var(--text);
            border-color: var(--green);
        }

        .filter-tab.active {
            background: var(--green);
            border-color: var(--green);
            color: var(--text);
        }

        /* Task list */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-item:hover {
            background: var(--card-hover);
            border-color: var(--green);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--card-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .task-item:hover .task-checkbox {
            border-color: var(--green);
        }

        .task-item.done .task-checkbox {
            background: var(--green);
            border-color: var(--green);
        }

        .task-item.done .task-checkbox::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
        }

        .task-priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .task-priority.P0 { background: var(--red); color: white; }
        .task-priority.P1 { background: var(--gold); color: black; }
        .task-priority.P2 { background: var(--card-border); color: var(--text-secondary); }
        .task-priority.P3 { background: transparent; color: var(--text-dim); border: 1px solid var(--card-border); }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: 0.9375rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .task-item.done .task-title {
            text-decoration: line-through;
            color: var(--text-dim);
        }

        .task-meta {
            display: flex;
            gap: 12px;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .task-project {
            padding: 2px 8px;
            background: var(--bg);
            border-radius: 4px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-project.sos { color: var(--green-bright); }
        .task-project.reforge { color: var(--blue); }
        .task-project.harmony { color: var(--gold); }
        .task-project.grunt { color: var(--green-light); }
        .task-project.context_graph { color: var(--purple); }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .assignee-avatar {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        /* Metrics bar */
        .metrics-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 16px;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .metric-value.positive { color: var(--green-bright); }
        .metric-value.warning { color: var(--gold); }
        .metric-value.negative { color: var(--red-light); }

        /* Project detail view */
        .project-detail {
            display: none;
        }

        .project-detail.active {
            display: block;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 16px;
            cursor: pointer;
        }

        .back-btn:hover {
            color: var(--green-bright);
        }

        /* Pipeline table */
        .pipeline-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pipeline-table th,
        .pipeline-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        .pipeline-table th {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-dim);
            background: var(--bg-secondary);
        }

        .pipeline-table tr:hover {
            background: var(--card-hover);
        }

        .deal-amount {
            font-weight: 600;
            color: var(--green-bright);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .projects-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .task-meta {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">‚ö°</div>
            <span>COMMAND CENTER</span>
        </div>
        <div class="header-right">
            <div class="user-badge">
                <div class="avatar">J</div>
                <span>Jonathan</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- All Projects View -->
        <div id="all-projects-view">
            <!-- Metrics -->
            <div class="metrics-bar">
                <div class="metric-card">
                    <div class="metric-label">Reforge Pipeline</div>
                    <div class="metric-value positive">$311K</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Won 2025</div>
                    <div class="metric-value">$50K</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Re-engageable</div>
                    <div class="metric-value warning">$508K</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Tasks P0/P1</div>
                    <div class="metric-value" id="urgent-tasks">-</div>
                </div>
            </div>

            <!-- Projects -->
            <div class="section-header">
                <div class="section-title">Projects</div>
            </div>
            <div class="projects-grid" id="projects-grid">
                <!-- Populated by JS -->
            </div>

            <!-- Filter tabs -->
            <div class="filter-tabs">
                <div class="filter-tab active" data-filter="all">All Tasks</div>
                <div class="filter-tab" data-filter="pending">Pending</div>
                <div class="filter-tab" data-filter="in_progress">In Progress</div>
                <div class="filter-tab" data-filter="done">Done</div>
            </div>

            <!-- Tasks -->
            <div class="section-header">
                <div class="section-title">Tasks</div>
                <div class="section-actions">
                    <button class="btn primary" onclick="addTask()">+ Add Task</button>
                </div>
            </div>
            <div class="task-list" id="task-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Project Detail View -->
        <div id="project-detail-view" class="project-detail">
            <div class="back-btn" onclick="showAllProjects()">‚Üê Back to all projects</div>
            <div id="project-detail-content">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <script>
        // Data - will be loaded from API
        let tasksData = null;
        let currentFilter = 'all';
        let currentProject = null;

        // Load data
        async function loadData() {
            try {
                const res = await fetch('data/tasks.json');
                tasksData = await res.json();
                render();
            } catch (e) {
                console.error('Failed to load tasks:', e);
                // Fallback data
                tasksData = { projects: {}, pipeline: {} };
                render();
            }
        }

        // Render everything
        function render() {
            renderProjects();
            renderTasks();
            updateMetrics();
        }

        // Render project cards
        function renderProjects() {
            const grid = document.getElementById('projects-grid');
            const projects = tasksData.projects || {};
            
            const projectColors = {
                sos: '#5cb85c',
                reforge: '#4a90d4',
                harmony: '#d4a530',
                grunt: '#2d5a2d',
                context_graph: '#8b5cf6'
            };

            const projectIcons = {
                sos: 'üÜò',
                reforge: 'üíº',
                harmony: 'üéØ',
                grunt: '‚ö°',
                context_graph: 'üß†'
            };

            grid.innerHTML = Object.entries(projects).map(([slug, project]) => {
                const tasks = project.tasks || [];
                const p0 = tasks.filter(t => t.status !== 'done' && (project.priority === 'P0' || t.priority === 'P0')).length;
                const p1 = tasks.filter(t => t.status !== 'done' && t.priority !== 'P0').length;
                const done = tasks.filter(t => t.status === 'done').length;

                return `
                    <div class="project-card" onclick="showProject('${slug}')" style="--project-color: ${projectColors[slug] || '#4a8c4a'}">
                        <div class="project-header">
                            <span class="project-icon">${projectIcons[slug] || 'üìÅ'}</span>
                            <span class="project-name">${project.name}</span>
                        </div>
                        <div class="project-stats">
                            ${p0 > 0 ? `<span class="stat p0">üî¥ ${p0} P0</span>` : ''}
                            ${p1 > 0 ? `<span class="stat p1">üü° ${p1}</span>` : ''}
                            ${done > 0 ? `<span class="stat done">‚úì ${done}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render task list
        function renderTasks() {
            const list = document.getElementById('task-list');
            const projects = tasksData.projects || {};
            
            // Flatten all tasks
            let allTasks = [];
            Object.entries(projects).forEach(([slug, project]) => {
                (project.tasks || []).forEach(task => {
                    allTasks.push({ ...task, projectSlug: slug, projectName: project.name });
                });
            });

            // Filter
            if (currentFilter !== 'all') {
                allTasks = allTasks.filter(t => t.status === currentFilter);
            }

            // Filter by project if selected
            if (currentProject) {
                allTasks = allTasks.filter(t => t.projectSlug === currentProject);
            }

            // Sort by priority then status
            const priorityOrder = { P0: 0, P1: 1, P2: 2, P3: 3 };
            const statusOrder = { pending: 0, in_progress: 1, blocked: 2, done: 3 };
            allTasks.sort((a, b) => {
                const pDiff = (priorityOrder[a.priority] || 2) - (priorityOrder[b.priority] || 2);
                if (pDiff !== 0) return pDiff;
                return (statusOrder[a.status] || 0) - (statusOrder[b.status] || 0);
            });

            list.innerHTML = allTasks.map(task => `
                <div class="task-item ${task.status || ''}" data-id="${task.id}">
                    <div class="task-checkbox" onclick="toggleTask('${task.id}', event)"></div>
                    <span class="task-priority ${task.priority || 'P2'}">${task.priority || 'P2'}</span>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="task-project ${task.projectSlug}">${task.projectSlug.toUpperCase()}</span>
                            ${task.notes ? `<span>${task.notes}</span>` : ''}
                        </div>
                    </div>
                    <div class="task-assignee">
                        <div class="assignee-avatar">H</div>
                    </div>
                </div>
            `).join('');

            // Update urgent count
            const urgentCount = allTasks.filter(t => 
                t.status !== 'done' && (t.priority === 'P0' || t.priority === 'P1')
            ).length;
            document.getElementById('urgent-tasks').textContent = urgentCount;
        }

        // Update metrics
        function updateMetrics() {
            if (tasksData.pipeline?.reforge) {
                // Metrics already set in HTML for now
            }
        }

        // Show project detail
        function showProject(slug) {
            currentProject = slug;
            document.getElementById('all-projects-view').style.display = 'none';
            document.getElementById('project-detail-view').classList.add('active');
            
            const project = tasksData.projects[slug];
            const content = document.getElementById('project-detail-content');
            
            // Reforge has pipeline
            let pipelineHtml = '';
            if (slug === 'reforge') {
                pipelineHtml = `
                    <div class="section-header">
                        <div class="section-title">Pipeline ($311K Active)</div>
                    </div>
                    <table class="pipeline-table">
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Amount</th>
                                <th>Product</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Neo Financial</td><td class="deal-amount">$60K</td><td>IA + Research</td><td>Pricing sent</td></tr>
                            <tr><td>EvenUp</td><td class="deal-amount">$50K</td><td>IA</td><td>In pilot</td></tr>
                            <tr><td>E&Y</td><td class="deal-amount">$30K</td><td>IA + Research</td><td>Discovery</td></tr>
                            <tr><td>Fox Local</td><td class="deal-amount">$27K</td><td>IA + R + Build</td><td>Budget 2-4 weeks</td></tr>
                            <tr><td>DreamHost</td><td class="deal-amount">$25K</td><td>IA</td><td>In pilot</td></tr>
                            <tr><td>Ecovadis</td><td class="deal-amount">$18K</td><td>Build + IA + Research</td><td>Starting pilot</td></tr>
                        </tbody>
                    </table>
                    <br><br>
                `;
            }

            content.innerHTML = `
                <h2 style="margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 2rem;">${slug === 'sos' ? 'üÜò' : slug === 'reforge' ? 'üíº' : slug === 'harmony' ? 'üéØ' : slug === 'grunt' ? '‚ö°' : 'üß†'}</span>
                    ${project.name}
                </h2>
                ${pipelineHtml}
                <div class="section-header">
                    <div class="section-title">Tasks</div>
                </div>
            `;

            // Re-render tasks filtered by project
            renderTasks();
            content.appendChild(document.getElementById('task-list').cloneNode(true));
        }

        // Show all projects
        function showAllProjects() {
            currentProject = null;
            document.getElementById('all-projects-view').style.display = 'block';
            document.getElementById('project-detail-view').classList.remove('active');
            renderTasks();
        }

        // Toggle task done
        function toggleTask(id, event) {
            event.stopPropagation();
            // Would update DB in real implementation
            const item = event.target.closest('.task-item');
            item.classList.toggle('done');
        }

        // Add task
        function addTask() {
            const title = prompt('Task title:');
            if (title) {
                // Would add to DB in real implementation
                alert('Task creation will be connected to Supabase');
            }
        }

        // Filter handling
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentFilter = tab.dataset.filter;
                renderTasks();
            });
        });

        // Initialize
        loadData();
    </script>
</body>
</html>
